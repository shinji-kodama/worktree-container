<!--
同期影響レポート
===================
- バージョン変更: 1.1.0 → 1.4.0 (MINOR: 新原則2件追加 + 技術制約変更)
- 変更された原則: なし
- 追加されたセクション:
  - IX. オープンソース配布（新規原則）
  - X. 詳細コードコメント（新規原則）
- 削除されたセクション: なし
- テンプレート更新状況:
  - .specify/templates/plan-template.md ✅ 更新不要（汎用テンプレート）
  - .specify/templates/spec-template.md ✅ 更新不要（汎用テンプレート）
  - .specify/templates/tasks-template.md ✅ 更新不要（汎用テンプレート）
  - .specify/templates/agent-file-template.md ✅ 更新不要（汎用テンプレート）
  - CLAUDE.md ⚠ 要更新（新原則の反映）
  - specs/001-worktree-container-cli/spec.md ⚠ 要更新（OSS・コメント要件追加）
  - specs/001-worktree-container-cli/plan.md ⚠ 要更新（コメント規約追加）
- フォローアップ TODO: なし
-->

# Worktree Container 憲法

## 基本原則

### I. CLI ファースト配布

本プロジェクトは Homebrew（および将来的に他のパッケージマネージャ）で
インストール可能な CLI ツールとして配布しなければならない（MUST）。
CLI が唯一のユーザーインターフェースである。すべての機能はコマンドライン
引数とサブコマンドでアクセス可能でなければならない（MUST）。出力は
人間可読形式と機械可読形式（JSON）の両方をサポートしなければならない
（MUST）。終了コードは Unix 規約に従わなければならない（MUST）
（0 = 成功、非ゼロ = エラー）。

### II. ワークツリー-コンテナ分離

本ツールで作成されるすべての Git ワークツリーは、独立した Dev Container
セットを持たなければならない（MUST）。コーディングエージェント駆動の
開発用にワークツリーを作成する際、ツールは以下を実行しなければならない
（MUST）:
- Git ワークツリーを作成する
- そのワークツリー用の Dev Container 設定をコピーまたは生成する
- ワークツリーにスコープされた必要な開発コンテナをすべて起動する
- ワークツリー環境間の完全な分離を保証し、複数のコーディングエージェントが
  競合なく同時に動作できるようにする

### III. ポート衝突ゼロ（NON-NEGOTIABLE）

ワークツリーコンテナ環境間のポート衝突は絶対に発生してはならない
（MUST NEVER）。システムは以下を実行しなければならない（MUST）:
- 既存のワークツリー環境が使用中のすべてのポートを検出する
- 新しいワークツリー環境作成時に衝突しないポートを自動的に割り当てる
- すべてのアクティブなワークツリー環境のポート割り当てを追跡する
- ユーザーがポートを手動で指定・管理する必要がないようにする（MUST NOT）；
  システムがこれを透過的に処理する

これは最優先の不変条件である。ポート衝突の可能性がある場合、操作は
衝突リスクを抱えたまま進行するのではなく、明確なエラーで失敗しなければ
ならない（MUST）。

### IV. 透過的ネットワーキング

ツールは単純にポート番号をシフトするよりも、リバースプロキシまたは
ロードバランサ方式（例: Traefik, Caddy, nginx）を優先して、正しい
ワークツリーコンテナセットにトラフィックをルーティングすべきである
（SHOULD）。プロキシベースの方式が実現可能かつ実用的である場合:
- ユーザーはポート番号を記憶する代わりに、安定したホスト名またはパスで
  サービスにアクセスする
- プロキシ層はツールによって自動管理されなければならない（MUST）
- プロキシベースのルーティングが特定のプロトコルやユースケースで
  実現不可能な場合、ポートシフトへのフォールバックは許容される

プロキシ方式が許容できない複雑さやレイテンシをもたらす場合、
原則 III に基づく自動割り当てによるポートシフトがフォールバックとなる。
この判断は実装計画に文書化しなければならない（MUST）。

### V. 言語非依存の実用主義

実装言語は事前に決定されていない。計画・設計フェーズにおいて、
以下の基準で候補言語を評価しなければならない（MUST）:
- クロスプラットフォームサポート（macOS が主、Linux が副）
- Homebrew パッケージングと配布の容易さ
- CLI ツールとしての適性（起動時間、バイナリ配布）
- Docker/コンテナ API のエコシステムサポート
- 保守性とコントリビュータのアクセシビリティ

選択した言語は実装計画に根拠とともに文書化しなければならない（MUST）。
評価対象の候補には Go, Rust, Swift, Python, TypeScript/Deno を
含むが、これらに限定されない。

### VI. 簡潔性・YAGNI

すべての機能と抽象化は、即座の具体的なユースケースに対して
その存在を正当化しなければならない（MUST）。仮説的な将来の要件の
ために構築してはならない。以下を優先する:
- 階層化された抽象化よりも直接的な解決策
- 外部依存関係よりも標準ライブラリ機能
- 網羅的な設定可能性よりも合理的なデフォルトを持つ少数の設定オプション
- 多目的フレームワークよりも単一目的の関数

### VII. テストファースト

すべてのコア機能に自動テストを伴わなければならない（MUST）:
- ポート割り当て、設定生成、ワークツリー管理ロジックのユニットテスト
- コンテナライフサイクル操作の統合テスト
- テストは実装の前または同時に記述しなければならない（MUST）
- main ブランチへのマージ前に CI が通過しなければならない（MUST）

### VIII. 日本語ドキュメント

本プロジェクトのすべてのドキュメント（マークダウンファイル）は
日本語で記述しなければならない（MUST）。対象範囲:
- constitution.md、spec.md、plan.md、tasks.md、research.md 等の
  SpecKit ワークフロー成果物
- CLAUDE.md 等のエージェント向けガイダンスファイル
- README.md およびユーザー向けドキュメント
- コミットメッセージとプルリクエストの説明文

以下は例外として英語を許容する:
- ソースコード内の識別子（変数名、関数名、型名）
- CLI のコマンド名・フラグ名・ヘルプテキスト（国際的な利用を考慮）
- 外部ライブラリや仕様の固有名詞（例: devcontainer.json, Traefik）
- Conventional Commits のプレフィックス（feat:, fix: 等）

AI エージェントへの応答・対話も日本語で行わなければならない（MUST）。

### IX. オープンソース配布

本プロジェクトはオープンソースソフトウェアとして公開しなければならない（MUST）。
以下の要件を満たさなければならない:
- 適切なオープンソースライセンス（MIT, Apache 2.0 等）を選定し、
  リポジトリルートに LICENSE ファイルを配置しなければならない（MUST）
- README.md にプロジェクトの概要、インストール方法、基本的な使い方、
  コントリビューション方法を記載しなければならない（MUST）
- 依存ライブラリのライセンス互換性を確認しなければならない（MUST）
- シークレット情報（API キー、トークン等）をリポジトリに含めてはならない
  （MUST NOT）

### X. 詳細コードコメント

プロジェクトオーナーが Go 言語に不慣れであること、およびオープンソースとして
外部コントリビュータの参入を容易にすることを考慮し、ソースコードには
詳細なコメントを記述しなければならない（MUST）。具体的には:
- すべての公開（エクスポート）関数・型・定数に GoDoc コメントを
  記述しなければならない（MUST）
- 非公開関数であっても、処理の意図や「なぜそうするのか」を説明する
  コメントを記述しなければならない（MUST）
- Go 言語固有のイディオム（ゴルーチン、チャネル、インターフェース、
  エラーハンドリングパターン等）を使用する箇所では、そのパターンの
  目的と動作を説明するコメントを付与しなければならない（MUST）
- 複雑なアルゴリズムやビジネスロジックにはステップごとの説明コメントを
  付与しなければならない（MUST）
- コメントは英語で記述する（ソースコード内の規約に準拠。原則 VIII の
  例外規定に該当）

## 技術制約

- **対象プラットフォーム**: macOS、Linux、Windows の3プラットフォームを
  サポートしなければならない（MUST）。
- **コンテナランタイム**: Docker Engine または Docker Desktop を
  サポートしなければならない（MUST）。Podman サポートは任意で延期。
- **Git**: Git ワークツリー機能に依存するため、
  Git >= 2.15 を要件としなければならない（MUST）。
- **Dev Container 仕様**: devcontainer.json 仕様を遵守しなければ
  ならない（MUST）。カスタム拡張は許容されるが、標準的な
  Dev Container ツールを破壊してはならない（MUST NOT）。
- **パッケージマネージャ**: 各プラットフォームの主要パッケージマネージャで
  インストール可能でなければならない（MUST）。
  - macOS / Linux: Homebrew（`brew install`）
  - Windows: WinGet（`winget install`）

## 開発ワークフロー

- すべての変更は、変更内容と理由の説明を含むプルリクエストを
  経なければならない（MUST）。
- main ブランチは常にリリース可能な状態でなければならない（MUST）。
- リリースにはセマンティックバージョニング（MAJOR.MINOR.PATCH）を
  使用しなければならない（MUST）。
- コミットメッセージは Conventional Commits 形式に従わなければ
  ならない（MUST）（例: `feat:`, `fix:`, `docs:`, `chore:`）。
- 各プルリクエストは単一の関心事を扱うべきである（SHOULD）。

## ガバナンス

本憲法はプロジェクトの方向性と交渉不可能な制約に関する権威ある
参照文書である。すべての実装判断、コードレビュー、アーキテクチャ上の
選択は、これらの原則に照らして評価しなければならない（MUST）。

- **改正**: 本憲法への変更は、根拠の文書化、レビュー、セマンティック
  バージョニング規則に基づくバージョニングが必要である（MUST）
  （MAJOR: 削除・再定義、MINOR: 追加、PATCH: 明確化）。
- **遵守**: すべてのプルリクエストとコードレビューは、変更が憲法の
  原則に違反していないことを検証しなければならない（MUST）。
  違反はマージ前にフラグを立て、解決しなければならない（MUST）。
- **衝突解決**: 原則間で衝突が生じた場合の優先順位:
  III（ポート衝突ゼロ）> II（ワークツリー-コンテナ分離）>
  VI（簡潔性）> その他。
- **ランタイムガイダンス**: 本憲法を補完するランタイム開発ガイダンスには
  `CLAUDE.md` を使用する。

**バージョン**: 1.4.0 | **制定日**: 2026-02-28 | **最終改正日**: 2026-02-28
